---
apiVersion: v1
kind: query
spec:
  automations_enabled: false
  description: Esentutl Execute, is a legitimate built-in command-line program it could be used to create a exe from dump raw source.
  discard_data: false
  interval: 600
  logging: ""
  min_osquery_version: ""
  name: MITRE - Database Utility
  observer_can_run: false
  platform: "windows"
  query: select * from file WHERE directory = 'C:\Windows\Prefetch\' and filename like '%esentutl%';
  team: ""
---
apiVersion: v1
kind: query
spec:
  automations_enabled: false
  description: Net Execute, is used in command-line operations for control of users, groups, services, and network connections - ATT&CK T1007
  discard_data: false
  interval: 600
  logging: ""
  min_osquery_version: ""
  name: MITRE - Network Commands
  observer_can_run: false
  platform: "windows"
  query: select * from file WHERE directory = 'C:\Windows\Prefetch\' and filename like '%net.exe%';
  team: ""
---
apiVersion: v1
kind: query
spec:
  automations_enabled: false
  description: SC.exe Execute, Service Control - Create, Start, Stop, Query or Delete any Windows SERVICE. . - ATT&CK T1007
  discard_data: false
  interval: 600
  logging: ""
  min_osquery_version: ""
  name: MITRE - Service Control
  observer_can_run: false
  platform: "windows"
  query: select * from file WHERE directory = 'C:\Windows\Prefetch\' and filename like '%sc%';
  team: ""
---
apiVersion: v1
kind: query
spec:
  automations_enabled: false
  description: Tasklist Execute, usaullay used to list task - ATT&CK T1007
  discard_data: false
  interval: 600
  logging: ""
  min_osquery_version: ""
  name: MITRE - Process Enumeration
  observer_can_run: false
  platform: "windows"
  query: select * from file WHERE directory = 'C:\Windows\Prefetch\' and filename like '%tasklist%';
  team: ""
---
apiVersion: v1
kind: query
spec:
  automations_enabled: false
  description: PsExec Execute, is a free Microsoft tool that can be used to execute a program on another computer. - ATT&CK T1021.002
  discard_data: false
  interval: 600
  logging: ""
  min_osquery_version: ""
  name: MITRE - PsExec Execution
  observer_can_run: false
  platform: "windows"
  query: select * from file WHERE directory = 'C:\Windows\Prefetch\' and filename like '%PsExec%';
  team: ""
---
apiVersion: v1
kind: query
spec:
  automations_enabled: false
  description: mstsc.exe Execute, usaullay used to perform a RDP Session  - ATT&CK T1021.001
  discard_data: false
  interval: 600
  logging: ""
  min_osquery_version: ""
  name: MITRE - Remote Desktop
  observer_can_run: false
  platform: "windows"
  query: select * from file WHERE directory = 'C:\Windows\Prefetch\' and filename like '%mstsc%';
  team: ""
---
apiVersion: v1
kind: query
spec:
  automations_enabled: false
  description: tscon.exe Execute, usaullay used to Terminal Services Console - ATT&CK T1021.001
  discard_data: false
  interval: 600
  logging: ""
  min_osquery_version: ""
  name: MITRE - Terminal Services
  observer_can_run: false
  platform: "windows"
  query: select * from file WHERE directory = 'C:\Windows\Prefetch\' and filename like '%tscon%';
  team: ""
---
apiVersion: v1
kind: query
spec:
  automations_enabled: false
  description: Users with an active shell on the system. - ATT&CK T1033
  discard_data: false
  interval: 3600
  logging: ""
  min_osquery_version: ""
  name: MITRE - Logged In Users
  observer_can_run: false
  platform: "windows"
  query: select * from logged_in_users;
  team: ""
---
apiVersion: v1
kind: query
spec:
  automations_enabled: false
  description: Local system users. - ATT&CK T1033
  discard_data: false
  interval: 3600
  logging: ""
  min_osquery_version: ""
  name: MITRE - Users
  observer_can_run: false
  platform: "windows"
  query: SELECT * FROM users;
  team: ""
---
apiVersion: v1
kind: query
spec:
  automations_enabled: false
  description: Users snapshot query - ATT&CK T1033
  discard_data: false
  interval: 28800
  logging: ""
  min_osquery_version: ""
  name: MITRE - Users Snapshot
  observer_can_run: false
  platform: "windows"
  query: SELECT * FROM users;
  team: ""
---
apiVersion: v1
kind: query
spec:
  automations_enabled: false
  description: Whoami Execute, used to prints the effective username of the current user
  discard_data: false
  interval: 600
  logging: ""
  min_osquery_version: ""
  name: MITRE - User Identification
  observer_can_run: false
  platform: "windows"
  query: select * from file WHERE directory = 'C:\Windows\Prefetch\' and filename like '%whoami%';
  team: ""
---
apiVersion: v1
kind: query
spec:
  automations_enabled: false
  description: Detect processes masquerading as legitimate Windows processes - ATT&CK T1036.004
  discard_data: false
  interval: 60
  logging: ""
  min_osquery_version: ""
  name: MITRE - Chrome Parent Process Validation
  observer_can_run: false
  platform: "windows"
  query: SELECT name as bad_parent_child_name, pid bad_parent_child_pid FROM processes WHERE pid=(SELECT parent FROM processes WHERE parent != (SELECT pid from processes where name='explorer.exe') AND LOWER(name)='chrome.exe') OR pid=(SELECT pid FROM processes WHERE parent != (SELECT pid from processes where name='explorer.exe') AND LOWER(name)='chrome.exe');
  team: ""
---
apiVersion: v1
kind: query
spec:
  automations_enabled: false
  description: Detect processes masquerading as legitimate Windows processes - ATT&CK T1036.004
  discard_data: false
  interval: 60
  logging: ""
  min_osquery_version: ""
  name: MITRE - CMD Parent Process Validation
  observer_can_run: false
  platform: "windows"
  query: SELECT name as bad_parent_child_name, pid bad_parent_child_pid FROM processes WHERE pid=(SELECT parent FROM processes WHERE parent!=(SELECT pid from processes where name='explorer.exe') AND LOWER(name)='cmd.exe') OR pid=(SELECT pid FROM processes WHERE parent!=(SELECT pid from processes where name='explorer.exe') AND LOWER(name)='cmd.exe');
  team: ""
---
apiVersion: v1
kind: query
spec:
  automations_enabled: false
  description: Detect processes masquerading as legitimate Windows processes - ATT&CK T1036.004
  discard_data: false
  interval: 60
  logging: ""
  min_osquery_version: ""
  name: MITRE - Conhost Parent Process Validation
  observer_can_run: false
  platform: "windows"
  query: SELECT name as bad_parent_child_name, pid bad_parent_child_pid FROM processes WHERE pid=(SELECT parent FROM processes WHERE parent != (SELECT pid from processes where name='csrss.exe') AND LOWER(name)='conhost.exe') OR pid=(SELECT pid FROM processes WHERE parent != (SELECT pid from processes where name='csrss.exe') AND LOWER(name)='conhost.exe');
  team: ""
---
apiVersion: v1
kind: query
spec:
  automations_enabled: false
  description: Detect processes masquerading as legitimate Windows processes - ATT&CK T1036.004
  discard_data: false
  interval: 60
  logging: ""
  min_osquery_version: ""
  name: MITRE - Firefox Parent Process Validation
  observer_can_run: false
  platform: "windows"
  query: SELECT name as bad_parent_child_name, pid bad_parent_child_pid FROM processes WHERE pid=(SELECT parent FROM processes WHERE parent!=(SELECT pid from processes where name='explorer.exe') AND LOWER(name)='firefox.exe') OR pid=(SELECT pid FROM processes WHERE parent!=(SELECT pid from processes where name='explorer.exe') AND LOWER(name)='firefox.exe');
  team: ""
---
apiVersion: v1
kind: query
spec:
  automations_enabled: false
  description: Detect processes masquerading as legitimate Windows processes - ATT&CK T1036.004
  discard_data: false
  interval: 60
  logging: ""
  min_osquery_version: ""
  name: MITRE - Internet Explorer Parent Process Validation
  observer_can_run: false
  platform: "windows"
  query: SELECT name as bad_parent_child_name, pid bad_parent_child_pid FROM processes WHERE pid=(SELECT parent FROM processes WHERE parent!=(SELECT pid from processes where name='explorer.exe') AND LOWER(name)='iexplore.exe') OR pid=(SELECT pid FROM processes WHERE parent!=(SELECT pid from processes where name='explorer.exe') AND LOWER(name)='iexplore.exe');
  team: ""
---
apiVersion: v1
kind: query
spec:
  automations_enabled: false
  description: Detect processes masquerading as legitimate Windows processes - ATT&CK T1036.004
  discard_data: false
  interval: 60
  logging: ""
  min_osquery_version: ""
  name: MITRE - LSASS Parent Process Validation
  observer_can_run: false
  platform: "windows"
  query: SELECT name as bad_parent_child_name, pid bad_parent_child_pid FROM processes WHERE pid=(SELECT parent FROM processes WHERE parent!=(SELECT pid from processes where name='wininit.exe') AND LOWER(name)='lsass.exe') OR pid=(SELECT pid FROM processes WHERE parent!=(SELECT pid from processes where name='wininit.exe') AND LOWER(name)='lsass.exe');
  team: ""
---
apiVersion: v1
kind: query
spec:
  automations_enabled: false
  description: Detect processes masquerading as legitimate Windows processes - ATT&CK T1036.004
  discard_data: false
  interval: 60
  logging: ""
  min_osquery_version: ""
  name: MITRE - Notepad++ Parent Process Validation
  observer_can_run: false
  platform: "windows"
  query: SELECT name as bad_parent_child_name, pid bad_parent_child_pid FROM processes WHERE pid=(SELECT parent FROM processes WHERE parent!=(SELECT pid from processes where name='explorer.exe') AND LOWER(name)='notepad++.exe') OR pid=(SELECT pid FROM processes WHERE parent!=(SELECT pid from processes where name='explorer.exe') AND LOWER(name)='notepad++.exe');
  team: ""
---
apiVersion: v1
kind: query
spec:
  automations_enabled: false
  description: Detect processes masquerading as legitimate Windows processes - ATT&CK T1036.004
  discard_data: false
  interval: 60
  logging: ""
  min_osquery_version: ""
  name: MITRE - Notepad Parent Process Validation
  observer_can_run: false
  platform: "windows"
  query: SELECT name as bad_parent_child_name, pid bad_parent_child_pid FROM processes WHERE pid=(SELECT parent FROM processes WHERE parent!=(SELECT pid from processes where name='explorer.exe') AND LOWER(name)='notepad.exe') OR pid=(SELECT pid FROM processes WHERE parent!=(SELECT pid from processes where name='explorer.exe') AND LOWER(name)='notepad.exe');
  team: ""
---
apiVersion: v1
kind: query
spec:
  automations_enabled: false
  description: Detect processes masquerading as legitimate Windows processes - ATT&CK T1036.004
  discard_data: false
  interval: 60
  logging: ""
  min_osquery_version: ""
  name: MITRE - PowerShell Parent Process Validation
  observer_can_run: false
  platform: "windows"
  query: SELECT name as bad_parent_child_name, pid bad_parent_child_pid FROM processes WHERE pid=(SELECT parent FROM processes WHERE parent!=(SELECT pid from processes where name='explorer.exe') AND LOWER(name)='powershell.exe') OR pid=(SELECT pid FROM processes WHERE parent!=(SELECT pid from processes where name='explorer.exe') AND LOWER(name)='powershell.exe');
  team: ""
---
apiVersion: v1
kind: query
spec:
  automations_enabled: false
  description: Detect processes masquerading as legitimate Windows processes - ATT&CK T1036.004
  discard_data: false
  interval: 60
  logging: ""
  min_osquery_version: ""
  name: MITRE - Services Parent Process Validation
  observer_can_run: false
  platform: "windows"
  query: SELECT name as bad_parent_child_name, pid bad_parent_child_pid FROM processes WHERE pid=(SELECT parent FROM processes WHERE parent!=(SELECT pid from processes where name='wininit.exe') AND LOWER(name)='services.exe') OR pid=(SELECT pid FROM processes WHERE parent!=(SELECT pid from processes where name='wininit.exe') AND LOWER(name)='services.exe');
  team: ""
---
apiVersion: v1
kind: query
spec:
  automations_enabled: false
  description: Detect processes masquerading as legitimate Windows processes - ATT&CK T1036.004
  discard_data: false
  interval: 60
  logging: ""
  min_osquery_version: ""
  name: MITRE - Svchost Parent Process Validation
  observer_can_run: false
  platform: "windows"
  query: SELECT name as bad_parent_child_name, pid bad_parent_child_pid FROM processes WHERE pid=(SELECT parent FROM processes WHERE parent!=(SELECT pid from processes where name='services.exe') AND LOWER(name)='svchost.exe') OR pid=(SELECT pid FROM processes WHERE parent!=(SELECT pid from processes where name='services.exe') AND LOWER(name)='svchost.exe');
  team: ""
---
apiVersion: v1
kind: query
spec:
  automations_enabled: false
  description: Detect processes masquerading as legitimate Windows processes - ATT&CK T1036.005
  discard_data: false
  interval: 3600
  logging: ""
  min_osquery_version: ""
  name: MITRE - Conhost Path Validation
  observer_can_run: false
  platform: "windows"
  query: SELECT * FROM processes WHERE LOWER(name)='conhost.exe' AND LOWER(path)!='c:\windows\system32\conhost.exe' AND path!='';
  team: ""
---
apiVersion: v1
kind: query
spec:
  automations_enabled: false
  description: Detect processes masquerading as legitimate Windows processes - ATT&CK T1036.005
  discard_data: false
  interval: 3600
  logging: ""
  min_osquery_version: ""
  name: MITRE - CSRSS Path Validation
  observer_can_run: false
  platform: "windows"
  query: SELECT * FROM processes WHERE LOWER(name)='crss.exe' AND LOWER(path)!='c:\windows\system32\crss.exe' AND path!='';
  team: ""
---
apiVersion: v1
kind: query
spec:
  automations_enabled: false
  description: Detect processes masquerading as legitimate Windows processes - ATT&CK T1036.005
  discard_data: false
  interval: 3600
  logging: ""
  min_osquery_version: ""
  name: MITRE - DLLHost Path Validation
  observer_can_run: false
  platform: "windows"
  query: SELECT * FROM processes WHERE LOWER(name)='dllhost.exe' AND LOWER(path)!='c:\windows\system32\dllhost.exe' AND LOWER(path)!='c:\windows\syswow64\dllhost.exe' AND path!='';
  team: ""
---
apiVersion: v1
kind: query
spec:
  automations_enabled: false
  description: Detect processes masquerading as legitimate Windows processes - ATT&CK T1036.005
  discard_data: false
  interval: 3600
  logging: ""
  min_osquery_version: ""
  name: MITRE - Explorer Path Validation
  observer_can_run: false
  platform: "windows"
  query: SELECT * FROM processes WHERE LOWER(name)='explorer.exe' AND LOWER(path)!='c:\windows\explorer.exe' AND LOWER(path)!='c:\windows\syswow64\explorer.exe' AND path!='';
  team: ""
---
apiVersion: v1
kind: query
spec:
  automations_enabled: false
  description: Detect processes masquerading as legitimate Windows processes - ATT&CK T1036.005
  discard_data: false
  interval: 3600
  logging: ""
  min_osquery_version: ""
  name: MITRE - LSASS Path Validation
  observer_can_run: false
  platform: "windows"
  query: SELECT * FROM processes WHERE LOWER(name)='lsass.exe' AND LOWER(path)!='c:\windows\system32\lsass.exe' AND path!='';
  team: ""
---
apiVersion: v1
kind: query
spec:
  automations_enabled: false
  description: Detect processes masquerading as legitimate Windows processes - ATT&CK T1036.005
  discard_data: false
  interval: 3600
  logging: ""
  min_osquery_version: ""
  name: MITRE - Services Path Validation
  observer_can_run: false
  platform: "windows"
  query: SELECT * FROM processes WHERE LOWER(name)='services.exe' AND LOWER(path)!='c:\windows\system32\services.exe' AND path!='';
  team: ""
---
apiVersion: v1
kind: query
spec:
  automations_enabled: false
  description: Detect processes masquerading as legitimate Windows processes - ATT&CK T1036.005
  discard_data: false
  interval: 3600
  logging: ""
  min_osquery_version: ""
  name: MITRE - SMSS Path Validation
  observer_can_run: false
  platform: "windows"
  query: SELECT * FROM processes WHERE LOWER(name)='smss.exe' AND LOWER(path)!='c:\windows\system32\smss.exe' AND path!='';
  team: ""
---
apiVersion: v1
kind: query
spec:
  automations_enabled: false
  description: Detect processes masquerading as legitimate Windows processes - ATT&CK T1036.005
  discard_data: false
  interval: 3600
  logging: ""
  min_osquery_version: ""
  name: MITRE - Svchost Path Validation
  observer_can_run: false
  platform: "windows"
  query: SELECT * FROM processes WHERE LOWER(name)='svchost.exe' AND LOWER(path)!='c:\windows\system32\svchost.exe' AND LOWER(path)!='c:\windows\syswow64\svchost.exe' AND path!='';
  team: ""
---
apiVersion: v1
kind: query
spec:
  automations_enabled: false
  description: Detect processes masquerading as legitimate Windows processes - ATT&CK T1036.005
  discard_data: false
  interval: 3600
  logging: ""
  min_osquery_version: ""
  name: MITRE - Wininit Path Validation
  observer_can_run: false
  platform: "windows"
  query: SELECT * FROM processes WHERE LOWER(name)='wininit.exe' AND LOWER(path)!='c:\windows\system32\wininit.exe' AND path!='';
  team: ""
---
apiVersion: v1
kind: query
spec:
  automations_enabled: false
  description: Detect processes masquerading as legitimate Windows processes - ATT&CK T1036.005
  discard_data: false
  interval: 3600
  logging: ""
  min_osquery_version: ""
  name: MITRE - Winlogon Path Validation
  observer_can_run: false
  platform: "windows"
  query: SELECT * FROM processes WHERE LOWER(name)='winlogon.exe' AND LOWER(path)!='c:\windows\system32\winlogon.exe' AND path!='';
  team: ""
---
apiVersion: v1
kind: query
spec:
  automations_enabled: false
  description: Detect processes masquerading as legitimate Windows processes - ATT&CK T1036.005
  discard_data: false
  interval: 3600
  logging: ""
  min_osquery_version: ""
  name: MITRE - WMI Provider Path Validation
  observer_can_run: false
  platform: "windows"
  query: SELECT * FROM processes WHERE LOWER(name)='wmiprvse.exe' AND LOWER(path)!='c:\windows\system32\wbem\wmiprvse.exe' AND LOWER(path)!='c:\windows\syswow64\wbem\wmiprvse.exe' AND path!='';
  team: ""
---
apiVersion: v1
kind: query
spec:
  automations_enabled: false
  description: Returns the content of the key HKEY_CURRENT_USER_Environment - ATT&CK T1037
  discard_data: false
  interval: 3600
  logging: ""
  min_osquery_version: ""
  name: MITRE - Registry Logon Scripts
  observer_can_run: false
  platform: "windows"
  query: select * from registry where key='HKEY_CURRENT_USER\Environment';
  team: ""
---
apiVersion: v1
kind: query
spec:
  automations_enabled: false
  description: Netstat Execute,  is an operating system utility that displays active TCP connections, listening ports, and network statistics. - ATT&CK T1049
  discard_data: false
  interval: 600
  logging: ""
  min_osquery_version: ""
  name: MITRE - Network Statistics
  observer_can_run: false
  platform: "windows"
  query: select * from file WHERE directory = 'C:\Windows\Prefetch\' and filename like '%netstat%';
  team: ""
---
apiVersion: v1
kind: query
spec:
  automations_enabled: false
  description: Lists all of the tasks in the Windows task scheduler - ATT&CK T1053.005
  discard_data: false
  interval: 3600
  logging: ""
  min_osquery_version: ""
  name: MITRE - Scheduled Tasks
  observer_can_run: false
  platform: "windows"
  query: select name,action,path,enabled,datetime(next_run_time,'unixepoch','UTC') from scheduled_tasks;
  team: ""
---
apiVersion: v1
kind: query
spec:
  automations_enabled: false
  description: Lists all of the tasks in the Windows task scheduler
  discard_data: false
  interval: 28800
  logging: ""
  min_osquery_version: ""
  name: MITRE - Scheduled Tasks Monitoring
  observer_can_run: false
  platform: "windows"
  query: select name,action,path,enabled,datetime(next_run_time,'unixepoch','UTC') from scheduled_tasks;
  team: ""
---
apiVersion: v1
kind: query
spec:
  automations_enabled: false
  description: **AppInit DLLs** Returns the content of the key HKLM_Software_Microsoft_WindowsNT_CurrentVersion_Windows - ATT&CK T1055.001
  discard_data: false
  interval: 3600
  logging: ""
  min_osquery_version: ""
  name: MITRE - Registry AppInit DLLs
  observer_can_run: false
  platform: "windows"
  query: select name,type,data from registry where key='HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Windows' and name='AppInit_DLLs';
  team: ""
---
apiVersion: v1
kind: query
spec:
  automations_enabled: false
  description: **AppInit DLLs** Returns the content of the key HKLM_Software_Wow6432Node_Microsoft_Windows NT_CurrentVersion_Windows - ATT&CK T1055.001
  discard_data: false
  interval: 3600
  logging: ""
  min_osquery_version: ""
  name: MITRE - Registry Wow6432Node AppInit DLLs
  observer_can_run: false
  platform: "windows"
  query: select name,type,data from registry where key='HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Windows' and name='AppInit_DLLs';
  team: ""
---
apiVersion: v1
kind: query
spec:
  automations_enabled: false
  description: **AppInit DLLs** Snapshot Returns the content of the key HKLM_Software_Microsoft_WindowsNT_CurrentVersion_Windows - ATT&CK T1055.001
  discard_data: false
  interval: 28800
  logging: ""
  min_osquery_version: ""
  name: MITRE - Registry Snapshot HKLM AppInit DLLs
  observer_can_run: false
  platform: "windows"
  query: select name,type,data from registry where key='HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Windows' and name='AppInit_DLLs';
  team: ""
---
apiVersion: v1
kind: query
spec:
  automations_enabled: false
  description: **AppInit DLLs** Snapshot Returns the content of the key HKLM_Software_Wow6432Node_Microsoft_Windows NT_CurrentVersion_Windows - ATT&CK T1055.001
  discard_data: false
  interval: 28800
  logging: ""
  min_osquery_version: ""
  name: MITRE - Registry Snapshot HKLM Wow6432Node AppInit DLLs
  observer_can_run: false
  platform: "windows"
  query: select name,type,data from registry where key='HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Windows' and name='AppInit_DLLs';
  team: ""
---
apiVersion: v1
kind: query
spec:
  automations_enabled: false
  description: List Windows System running processes. - ATT&CK T1057
  discard_data: false
  interval: 3600
  logging: ""
  min_osquery_version: ""
  name: MITRE - System Running Processes
  observer_can_run: false
  platform: "windows"
  query: select processes.pid, processes.name, users.username, processes.path, processes.cmdline from processes LEFT JOIN users ON processes.uid = users.uid WHERE processes.path != '';
  team: ""
---
apiVersion: v1
kind: query
spec:
  automations_enabled: false
  description: Snapshot List Windows System running processes - ATT&CK T1057
  discard_data: false
  interval: 28800
  logging: ""
  min_osquery_version: ""
  name: MITRE - System Running Processes Snapshot
  observer_can_run: false
  platform: "windows"
  query: select processes.pid, processes.name, users.username, processes.path from processes LEFT JOIN users ON processes.uid = users.uid WHERE processes.path != '';
  team: ""
---
apiVersion: v1
kind: query
spec:
  automations_enabled: false
  description: Detect Processes running without a binary on disk
  discard_data: false
  interval: 3600
  logging: ""
  min_osquery_version: ""
  name: MITRE - Processes Without Binary on Disk
  observer_can_run: false
  platform: "windows"
  query: SELECT name, path, pid FROM processes WHERE on_disk = 0;
  team: ""
---
apiVersion: v1
kind: query
spec:
  automations_enabled: false
  description: SVCHOST Processes not using the -k [name] convention
  discard_data: false
  interval: 600
  logging: ""
  min_osquery_version: ""
  name: MITRE - Anomalous Svchost
  observer_can_run: false
  platform: "windows"
  query: select * from processes where name like 'svchost.exe' and cmdline not like '%-k%';
  team: ""
---
apiVersion: v1
kind: query
spec:
  automations_enabled: false
  description: Powershell script blocks reconstructed to their full script content, this table requires script block logging to be enabled. - ATT&CK T1059.001
  discard_data: false
  interval: 3600
  logging: ""
  min_osquery_version: ""
  name: MITRE - PowerShell Events Script Blocks
  observer_can_run: false
  platform: "windows"
  query: select * from powershell_events;
  team: ""
---
apiVersion: v1
kind: query
spec:
  automations_enabled: false
  description: Snapshot Prefetach File Directory - ATT&CK T1070.004
  discard_data: false
  interval: 28800
  logging: ""
  min_osquery_version: ""
  name: MITRE - Prefetch File Monitoring
  observer_can_run: false
  platform: "windows"
  query: select * from file WHERE directory = 'C:\Windows\Prefetch\';
  team: ""
---
apiVersion: v1
kind: query
spec:
  automations_enabled: false
  description: Attrib Execute, usaullay used to modify file attributes - ATT&CK T1070.001
  discard_data: false
  interval: 600
  logging: ""
  min_osquery_version: ""
  name: MITRE - File Attribute Modification
  observer_can_run: false
  platform: "windows"
  query: select * from file WHERE directory = 'C:\Windows\Prefetch\' and filename like '%attrib%';
  team: ""
---
apiVersion: v1
kind: query
spec:
  automations_enabled: false
  description: Vssadmin Execute, usaullay used to execute activity on Volume Shadow copy
  discard_data: false
  interval: 600
  logging: ""
  min_osquery_version: ""
  name: MITRE - Volume Shadow Copy
  observer_can_run: false
  platform: "windows"
  query: select * from file WHERE directory = 'C:\Windows\Prefetch\' and filename like '%vssadmin%';
  team: ""
---
apiVersion: v1
kind: query
spec:
  automations_enabled: false
  description: Local system users. - ATT&CK T1082
  discard_data: false
  interval: 3600
  logging: ""
  min_osquery_version: ""
  name: MITRE - Certificates
  observer_can_run: false
  platform: "windows"
  query: select * from certificates;
  team: ""
---
apiVersion: v1
kind: query
spec:
  automations_enabled: false
  description: Users snapshot query - ATT&CK T1082
  discard_data: false
  interval: 28800
  logging: ""
  min_osquery_version: ""
  name: MITRE - Certificates Snapshot
  observer_can_run: false
  platform: "windows"
  query: select * from certificates;
  team: ""
---
apiVersion: v1
kind: query
spec:
  automations_enabled: false
  description: Local system users.
  discard_data: false
  interval: 28800
  logging: ""
  min_osquery_version: ""
  name: MITRE - Programs Snapshot
  observer_can_run: false
  platform: "windows"
  query: select * from programs;
  team: ""
---
apiVersion: v1
kind: query
spec:
  automations_enabled: false
  description: System information for identification.
  discard_data: false
  interval: 3600
  logging: ""
  min_osquery_version: ""
  name: MITRE - System Information
  observer_can_run: false
  platform: "windows"
  query: SELECT * FROM system_info;
  team: ""
---
apiVersion: v1
kind: query
spec:
  automations_enabled: false
  description: System info snapshot query
  discard_data: false
  interval: 28800
  logging: ""
  min_osquery_version: ""
  name: MITRE - System Information Snapshot
  observer_can_run: false
  platform: "windows"
  query: SELECT * FROM system_info;
  team: ""
---
apiVersion: v1
kind: query
spec:
  automations_enabled: false
  description: System uptime
  discard_data: false
  interval: 28800
  logging: ""
  min_osquery_version: ""
  name: MITRE - System Uptime
  observer_can_run: false
  platform: "windows"
  query: SELECT * FROM uptime;
  team: ""
---
apiVersion: v1
kind: query
spec:
  automations_enabled: false
  description: Systeminfo Execute, Systeminfo is a Windows utility that can be used to gather detailed information about a computer. - ATT&CK T1082
  discard_data: false
  interval: 600
  logging: ""
  min_osquery_version: ""
  name: MITRE - System Information
  observer_can_run: false
  platform: "windows"
  query: select * from file WHERE directory = 'C:\Windows\Prefetch\' and filename like '%systeminfo%';
  team: ""
---
apiVersion: v1
kind: query
spec:
  automations_enabled: false
  description: Check suspicious file creation under AppData\Local - ATT&CK T1083
  discard_data: false
  interval: 1800
  logging: ""
  min_osquery_version: ""
  name: MITRE - AppData Local Files
  observer_can_run: false
  platform: "windows"
  query: SELECT hash.md5, path, file.filename, datetime(file.btime, 'unixepoch', 'UTC') as btime, datetime(file.atime, 'unixepoch', 'UTC') as atime, datetime(file.ctime, 'unixepoch', 'UTC') as ctime, datetime(file.mtime, 'unixepoch', 'UTC') as mtime FROM hash JOIN file USING (path) where path like 'C:\users\%\AppData\Local\%' and type='regular';
  team: ""
---
apiVersion: v1
kind: query
spec:
  automations_enabled: false
  description: Check suspicious file creation under %TEMP% or AppData\Local\Temp - ATT&CK T1083
  discard_data: false
  interval: 1800
  logging: ""
  min_osquery_version: ""
  name: MITRE - AppData Local Temp Files
  observer_can_run: false
  platform: "windows"
  query: SELECT hash.md5, path, file.filename, datetime(file.btime, 'unixepoch', 'UTC') as btime, datetime(file.atime, 'unixepoch', 'UTC') as atime, datetime(file.ctime, 'unixepoch', 'UTC') as ctime, datetime(file.mtime, 'unixepoch', 'UTC') as mtime FROM hash JOIN file USING (path) where path like 'C:\users\%\AppData\Local\temp\%' and type='regular';
  team: ""
---
apiVersion: v1
kind: query
spec:
  automations_enabled: false
  description: Check suspicious file creation under %APPDATA% or %\AppData\Roaming - ATT&CK T1083
  discard_data: false
  interval: 1800
  logging: ""
  min_osquery_version: ""
  name: MITRE - AppData Roaming Files
  observer_can_run: false
  platform: "windows"
  query: SELECT hash.md5, path, file.filename, datetime(file.btime, 'unixepoch', 'UTC') as btime, datetime(file.atime, 'unixepoch', 'UTC') as atime, datetime(file.ctime, 'unixepoch', 'UTC') as ctime, datetime(file.mtime, 'unixepoch', 'UTC') as mtime FROM hash JOIN file USING (path) where path like 'C:\users\%\AppData\Roaming\%' and type='regular';
  team: ""
---
apiVersion: v1
kind: query
spec:
  automations_enabled: false
  description: Check suspicious file creation under ProgramData\Microsoft\Windows\Start Menu - ATT&CK T1083
  discard_data: false
  interval: 1800
  logging: ""
  min_osquery_version: ""
  name: MITRE - ProgramData Start Menu Files
  observer_can_run: false
  platform: "windows"
  query: SELECT hash.md5, path, file.filename, datetime(file.btime, 'unixepoch', 'UTC') as btime, datetime(file.atime, 'unixepoch', 'UTC') as atime, datetime(file.ctime, 'unixepoch', 'UTC') as ctime, datetime(file.mtime, 'unixepoch', 'UTC') as mtime FROM hash JOIN file USING (path) where path like 'C:\ProgramData\Microsoft\Windows\Start Menu\%' AND type='regular';
  team: ""
---
apiVersion: v1
kind: query
spec:
  automations_enabled: false
  description: Check suspicious file creation under ProgramData\Microsoft\Windows\Start Menu\Programs - ATT&CK T1083
  discard_data: false
  interval: 1800
  logging: ""
  min_osquery_version: ""
  name: MITRE - ProgramData Start Menu Program Files
  observer_can_run: false
  platform: "windows"
  query: SELECT hash.md5, path, file.filename, datetime(file.btime, 'unixepoch', 'UTC') as btime, datetime(file.atime, 'unixepoch', 'UTC') as atime, datetime(file.ctime, 'unixepoch', 'UTC') as ctime, datetime(file.mtime, 'unixepoch', 'UTC') as mtime FROM hash JOIN file USING (path) where path like 'C:\ProgramData\Microsoft\Windows\Start Menu\Programs\%' AND type='regular';
  team: ""
---
apiVersion: v1
kind: query
spec:
  automations_enabled: false
  description: Check suspicious file creation under Roaming\Microsoft\Windows\Start Menu\Programs - ATT&CK T1083
  discard_data: false
  interval: 1800
  logging: ""
  min_osquery_version: ""
  name: MITRE - User Start Menu Program Files
  observer_can_run: false
  platform: "windows"
  query: SELECT hash.md5, path, file.filename, datetime(file.btime, 'unixepoch', 'UTC') as btime, datetime(file.atime, 'unixepoch', 'UTC') as atime, datetime(file.ctime, 'unixepoch', 'UTC') as ctime, datetime(file.mtime, 'unixepoch', 'UTC') as mtime FROM hash JOIN file USING (path) where path like 'C:\users\%\AppData\Roaming\Microsoft\Windows\Start Menu\Programs\%' AND type='regular';
  team: ""
---
apiVersion: v1
kind: query
spec:
  automations_enabled: false
  description: Check suspicious file creation under Roaming\Microsoft\Windows\Start Menu\Programs\Startup - ATT&CK T1083
  discard_data: false
  interval: 1800
  logging: ""
  min_osquery_version: ""
  name: MITRE - User Start Menu Startup Files
  observer_can_run: false
  platform: "windows"
  query: SELECT hash.md5, path, file.filename, datetime(file.btime, 'unixepoch', 'UTC') as btime, datetime(file.atime, 'unixepoch', 'UTC') as atime, datetime(file.ctime, 'unixepoch', 'UTC') as ctime, datetime(file.mtime, 'unixepoch', 'UTC') as mtime FROM hash JOIN file USING (path) where path like 'C:\users\%\AppData\Roaming\Microsoft\Windows\Start Menu\Programs\Startup\%' AND type='regular';
  team: ""
---
apiVersion: v1
kind: query
spec:
  automations_enabled: false
  description: Check suspicious file creation under c:\windows - ATT&CK T1083
  discard_data: false
  interval: 1800
  logging: ""
  min_osquery_version: ""
  name: MITRE - Windows New Files
  observer_can_run: false
  platform: "windows"
  query: SELECT hash.md5, path, file.filename, datetime(file.btime, 'unixepoch', 'UTC') as btime, datetime(file.atime, 'unixepoch', 'UTC') as atime, datetime(file.ctime, 'unixepoch', 'UTC') as ctime, datetime(file.mtime, 'unixepoch', 'UTC') as mtime FROM hash JOIN file USING (path) where path like 'C:\Windows\%' and type='regular';
  team: ""
---
apiVersion: v1
kind: query
spec:
  automations_enabled: false
  description: Check suspicious file creation under c:\windows\temp - ATT&CK T1083
  discard_data: false
  interval: 1800
  logging: ""
  min_osquery_version: ""
  name: MITRE - Windows Temp Files
  observer_can_run: false
  platform: "windows"
  query: SELECT hash.md5, path, file.filename, datetime(file.btime, 'unixepoch', 'UTC') as btime, datetime(file.atime, 'unixepoch', 'UTC') as atime, datetime(file.ctime, 'unixepoch', 'UTC') as ctime, datetime(file.mtime, 'unixepoch', 'UTC') as mtime FROM hash JOIN file USING (path) where path like 'C:\Windows\temp\%' and type='regular';
  team: ""
---
apiVersion: v1
kind: query
spec:
  automations_enabled: false
  description: Check suspicious directory creation under AppData\Local - ATT&CK T1083
  discard_data: false
  interval: 1800
  logging: ""
  min_osquery_version: ""
  name: MITRE - AppData Local New Directory
  observer_can_run: false
  platform: "windows"
  query: select f.path,f.directory,u.username,f.hard_links,f.symlink,datetime(f.btime, 'unixepoch', 'UTC') as btime, datetime(f.atime, 'unixepoch', 'UTC') as atime, datetime(f.ctime, 'unixepoch', 'UTC') as ctime, datetime(f.mtime, 'unixepoch', 'UTC') as mtime from file f LEFT JOIN users u on f.uid=u.uid where f.path like 'C:\users\%\AppData\Local\%' AND f.type='directory';
  team: ""
---
apiVersion: v1
kind: query
spec:
  automations_enabled: false
  description: Check suspicious directory creation under %TEMP% or AppData\Local\Temp - ATT&CK T1083
  discard_data: false
  interval: 1800
  logging: ""
  min_osquery_version: ""
  name: MITRE - AppData Local Temp Directory
  observer_can_run: false
  platform: "windows"
  query: select f.path,f.directory,u.username,f.hard_links,f.symlink,datetime(f.btime, 'unixepoch', 'UTC') as btime, datetime(f.atime, 'unixepoch', 'UTC') as atime, datetime(f.ctime, 'unixepoch', 'UTC') as ctime, datetime(f.mtime, 'unixepoch', 'UTC') as mtime from file f LEFT JOIN users u on f.uid=u.uid where f.path like 'C:\users\%\AppData\local\temp\%' AND f.type='directory';
  team: ""
---
apiVersion: v1
kind: query
spec:
  automations_enabled: false
  description: Check suspicious directory creation under %APPDATA% or %\AppData\Roaming - ATT&CK T1083
  discard_data: false
  interval: 1800
  logging: ""
  min_osquery_version: ""
  name: MITRE - AppData Roaming New Directory
  observer_can_run: false
  platform: "windows"
  query: select f.path,f.directory,u.username,f.hard_links,f.symlink,datetime(f.btime, 'unixepoch', 'UTC') as btime, datetime(f.atime, 'unixepoch', 'UTC') as atime, datetime(f.ctime, 'unixepoch', 'UTC') as ctime, datetime(f.mtime, 'unixepoch', 'UTC') as mtime from file f LEFT JOIN users u on f.uid=u.uid where f.path like 'C:\users\%\AppData\Roaming\%' AND f.type='directory';
  team: ""
---
apiVersion: v1
kind: query
spec:
  automations_enabled: false
  description: Check suspicious directory creation under Roaming\Microsoft\Windows\Start Menu\Programs - ATT&CK T1083
  discard_data: false
  interval: 1800
  logging: ""
  min_osquery_version: ""
  name: MITRE - User Start Menu Program Directory
  observer_can_run: false
  platform: "windows"
  query: select f.path,f.directory,u.username,f.hard_links,f.symlink,datetime(f.btime, 'unixepoch', 'UTC') as btime, datetime(f.atime, 'unixepoch', 'UTC') as atime, datetime(f.ctime, 'unixepoch', 'UTC') as ctime, datetime(f.mtime, 'unixepoch', 'UTC') as mtime from file f LEFT JOIN users u on f.uid=u.uid where f.path like 'C:\users\%\AppData\Roaming\Microsoft\Windows\Start Menu\Programs\%' AND f.type='directory';
  team: ""
---
apiVersion: v1
kind: query
spec:
  automations_enabled: false
  description: Check suspicious directory creation under Roaming\Microsoft\Windows\Start Menu\Programs\Startup - ATT&CK T1083
  discard_data: false
  interval: 1800
  logging: ""
  min_osquery_version: ""
  name: MITRE - User Start Menu Startup Directory
  observer_can_run: false
  platform: "windows"
  query: select f.path,f.directory,u.username,f.hard_links,f.symlink,datetime(f.btime, 'unixepoch', 'UTC') as btime, datetime(f.atime, 'unixepoch', 'UTC') as atime, datetime(f.ctime, 'unixepoch', 'UTC') as ctime, datetime(f.mtime, 'unixepoch', 'UTC') as mtime from file f LEFT JOIN users u on f.uid=u.uid where f.path like 'C:\users\%\AppData\Roaming\Microsoft\Windows\Start Menu\Programs\Startup\%' AND f.type='directory';
  team: ""
---
apiVersion: v1
kind: query
spec:
  automations_enabled: false
  description: Check suspicious directory creation under ProgramData\Microsoft\Windows\Start Menu - ATT&CK T1083
  discard_data: false
  interval: 1800
  logging: ""
  min_osquery_version: ""
  name: MITRE - ProgramData Start Menu Directory
  observer_can_run: false
  platform: "windows"
  query: select f.path,f.directory,u.username,f.hard_links,f.symlink,datetime(f.btime, 'unixepoch', 'UTC') as btime, datetime(f.atime, 'unixepoch', 'UTC') as atime, datetime(f.ctime, 'unixepoch', 'UTC') as ctime, datetime(f.mtime, 'unixepoch', 'UTC') as mtime from file f LEFT JOIN users u on f.uid=u.uid where f.path like 'C:\ProgramData\Microsoft\Windows\Start Menu\%' AND f.type='directory';
  team: ""
---
apiVersion: v1
kind: query
spec:
  automations_enabled: false
  description: Check suspicious directory creation under ProgramData\Microsoft\Windows\Start Menu\Programs - ATT&CK T1083
  discard_data: false
  interval: 1800
  logging: ""
  min_osquery_version: ""
  name: MITRE - ProgramData Start Menu Program Directory
  observer_can_run: false
  platform: "windows"
  query: select f.path,f.directory,u.username,f.hard_links,f.symlink,datetime(f.btime, 'unixepoch', 'UTC') as btime, datetime(f.atime, 'unixepoch', 'UTC') as atime, datetime(f.ctime, 'unixepoch', 'UTC') as ctime, datetime(f.mtime, 'unixepoch', 'UTC') as mtime from file f LEFT JOIN users u on f.uid=u.uid where f.path like 'C:\ProgramData\Microsoft\Windows\Start Menu\Programs\%' AND f.type='directory';
  team: ""
---
apiVersion: v1
kind: query
spec:
  automations_enabled: false
  description: Check suspicious directory creation under c:\windows - ATT&CK T1083
  discard_data: false
  interval: 1800
  logging: ""
  min_osquery_version: ""
  name: MITRE - Windows New Directory
  observer_can_run: false
  platform: "windows"
  query: select f.path,f.directory,u.username,f.hard_links,f.symlink,datetime(f.btime, 'unixepoch', 'UTC') as btime, datetime(f.atime, 'unixepoch', 'UTC') as atime, datetime(f.ctime, 'unixepoch', 'UTC') as ctime, datetime(f.mtime, 'unixepoch', 'UTC') as mtime from file f LEFT JOIN users u on f.uid=u.uid where f.path like 'C:\Windows\%' AND f.type='directory';
  team: ""
---
apiVersion: v1
kind: query
spec:
  automations_enabled: false
  description: Check suspicious directory creation under c:\windows\temp - ATT&CK T1083
  discard_data: false
  interval: 1800
  logging: ""
  min_osquery_version: ""
  name: MITRE - Windows Temp New Directory
  observer_can_run: false
  platform: "windows"
  query: select f.path,f.directory,u.username,f.hard_links,f.symlink,datetime(f.btime, 'unixepoch', 'UTC') as btime, datetime(f.atime, 'unixepoch', 'UTC') as atime, datetime(f.ctime, 'unixepoch', 'UTC') as ctime, datetime(f.mtime, 'unixepoch', 'UTC') as mtime from file f LEFT JOIN users u on f.uid=u.uid where f.path like 'C:\Windows\temp\%' AND f.type='directory';
  team: ""
---
apiVersion: v1
kind: query
spec:
  automations_enabled: false
  description: Xcopy Execute, is used for copying multiple files or entire directory trees from one directory to another and for copying files across a network.
  discard_data: false
  interval: 600
  logging: ""
  min_osquery_version: ""
  name: MITRE - File Copy
  observer_can_run: false
  platform: "windows"
  query: select * from file WHERE directory = 'C:\Windows\Prefetch\' and filename like '%xcopy%';
  team: ""
---
apiVersion: v1
kind: query
spec:
  automations_enabled: false
  description: Command-Line Interface Execute, CMD execution - ATT&CK T1106
  discard_data: false
  interval: 600
  logging: ""
  min_osquery_version: ""
  name: MITRE - Command Line Interface
  observer_can_run: false
  platform: "windows"
  query: select * from file WHERE directory = 'C:\Windows\Prefetch\' and filename like '%CMD%';
  team: ""
---
apiVersion: v1
kind: query
spec:
  automations_enabled: false
  description: POWERSHELL Execute, is a powerful interactive command-line interface and scripting environment included in the Windows operating system - ATT&CK T1106
  discard_data: false
  interval: 600
  logging: ""
  min_osquery_version: ""
  name: MITRE - PowerShell Execution
  observer_can_run: false
  platform: "windows"
  query: select * from file WHERE directory = 'C:\Windows\Prefetch\' and filename like '%POWERSHELL%';
  team: ""
---
apiVersion: v1
kind: query
spec:
  automations_enabled: false
  description: Reg Execute, Reg is a Windows utility used to interact with the Windows Registry.  - ATT&CK T1112
  discard_data: false
  interval: 600
  logging: ""
  min_osquery_version: ""
  name: MITRE - Registry Modification
  observer_can_run: false
  platform: "windows"
  query: select * from file WHERE directory = 'C:\Windows\Prefetch\' and filename like '%reg%';
  team: ""
---
apiVersion: v1
kind: query
spec:
  automations_enabled: false
  description: Regedit Execute, is a Windows utility used to interact with the Windows Registry. - ATT&CK T1112
  discard_data: false
  interval: 600
  logging: ""
  min_osquery_version: ""
  name: MITRE - Registry Editor
  observer_can_run: false
  platform: "windows"
  query: select * from file WHERE directory = 'C:\Windows\Prefetch\' and filename like '%regedit%';
  team: ""
---
apiVersion: v1
kind: query
spec:
  automations_enabled: false
  description: taskeng Execute, usaullay used to create a scheduled task - ATT&CK T1124
  discard_data: false
  interval: 600
  logging: ""
  min_osquery_version: ""
  name: MITRE - Task Engine
  observer_can_run: false
  platform: "windows"
  query: select * from file WHERE directory = 'C:\Windows\Prefetch\' and filename like '%taskeng%';
  team: ""
---
apiVersion: v1
kind: query
spec:
  automations_enabled: false
  description: Lists all chrome extensions - ATT&CK T1176
  discard_data: false
  interval: 3600
  logging: ""
  min_osquery_version: ""
  name: MITRE - Browser Extensions Chrome
  observer_can_run: false
  platform: "windows"
  query: select u.username, ce.name,ce.identifier,ce.version,ce.description,ce.locale,ce.update_url,ce.author,ce.persistent,ce.path from chrome_extensions ce LEFT JOIN users u ON ce.uid = u.uid;
  team: ""
---
apiVersion: v1
kind: query
spec:
  automations_enabled: false
  description: Lists all internet explorer extensions - ATT&CK T1176
  discard_data: false
  interval: 3600
  logging: ""
  min_osquery_version: ""
  name: MITRE - Browser Extensions Internet Explorer
  observer_can_run: false
  platform: "windows"
  query: select * from ie_extensions;
  team: ""
---
apiVersion: v1
kind: query
spec:
  automations_enabled: false
  description: Snapshot Lists all chrome extensions - ATT&CK T1176
  discard_data: false
  interval: 28800
  logging: ""
  min_osquery_version: ""
  name: MITRE - Browser Extensions Chrome Snapshot
  observer_can_run: false
  platform: "windows"
  query: select u.username, ce.name,ce.identifier,ce.version,ce.description,ce.locale,ce.update_url,ce.author,ce.persistent,ce.path from chrome_extensions ce LEFT JOIN users u ON ce.uid = u.uid;
  team: ""
---
apiVersion: v1
kind: query
spec:
  automations_enabled: false
  description: Snapshot Lists all internet explorer extensions - ATT&CK T1176
  discard_data: false
  interval: 28800
  logging: ""
  min_osquery_version: ""
  name: MITRE - Browser Extensions Internet Explorer Snapshot
  observer_can_run: false
  platform: "windows"
  query: ' select * from  ie_extensions;'
  team: ""
---
apiVersion: v1
kind: query
spec:
  automations_enabled: false
  description: Bitsadmin Execute, Windows Background Intelligent Transfer Service (BITS) is a low-bandwidth, asynchronous file transfer mechanism exposed through Component Object Model (COM) - ATT&CK T1197
  discard_data: false
  interval: 600
  logging: ""
  min_osquery_version: ""
  name: MITRE - BITS Transfer
  observer_can_run: false
  platform: "windows"
  query: select * from file WHERE directory = 'C:\Windows\Prefetch\' and filename like '%bitsadmin%';
  team: ""
---
apiVersion: v1
kind: query
spec:
  automations_enabled: false
  description: Extracted information from Windows crash logs (Minidumps).
  discard_data: false
  interval: 3600
  logging: ""
  min_osquery_version: ""
  name: MITRE - Windows Crashes
  observer_can_run: false
  platform: "windows"
  query: SELECT * FROM windows_crashes;
  team: ""
---
apiVersion: v1
kind: query
spec:
  automations_enabled: false
  description: Command-Line Interface Execute, Cscript execution starts a script so that it runs in a command-line environment. - ATT&CK T1216
  discard_data: false
  interval: 600
  logging: ""
  min_osquery_version: ""
  name: MITRE - Script Execution
  observer_can_run: false
  platform: "windows"
  query: select * from file WHERE directory = 'C:\Windows\Prefetch\' and filename like '%cscript%';
  team: ""
---
apiVersion: v1
kind: query
spec:
  automations_enabled: false
  description: InstallUtil Execute, InstallUtil is a command-line utility that allows for installation and uninstallation of resources by executing specific installer components specified in .NET binaries - ATT&CK T1218.004
  discard_data: false
  interval: 600
  logging: ""
  min_osquery_version: ""
  name: MITRE - InstallUtil Execution
  observer_can_run: false
  platform: "windows"
  query: select * from file WHERE directory = 'C:\Windows\Prefetch\' and filename like '%InstallUtil%';
  team: ""
---
apiVersion: v1
kind: query
spec:
  automations_enabled: false
  description: CMSTP Execute, The Microsoft Connection Manager Profile Installer (CMSTP.exe) is a command-line program used to install Connection Manager service profiles. - ATT&CK T1218.003
  discard_data: false
  interval: 600
  logging: ""
  min_osquery_version: ""
  name: MITRE - Connection Manager Profile
  observer_can_run: false
  platform: "windows"
  query: select * from file WHERE directory = 'C:\Windows\Prefetch\' and filename like '%CMSTP%';
  team: ""
---
apiVersion: v1
kind: query
spec:
  automations_enabled: false
  description: Mshta Execute, is a utility that executes Microsoft HTML Applications (HTA) - ATT&CK T1218.005
  discard_data: false
  interval: 600
  logging: ""
  min_osquery_version: ""
  name: MITRE - HTML Application
  observer_can_run: false
  platform: "windows"
  query: select * from file WHERE directory = 'C:\Windows\Prefetch\' and filename like '%mshta%';
  team: ""
---
apiVersion: v1
kind: query
spec:
  automations_enabled: false
  description: Certutil Execute, Certutil.exe is a legitimate built-in command-line program to manage certificates in Windows - ATT&CK T1218.003
  discard_data: false
  interval: 600
  logging: ""
  min_osquery_version: ""
  name: MITRE - Certificate Utility
  observer_can_run: false
  platform: "windows"
  query: select * from file WHERE directory = 'C:\Windows\Prefetch\' and filename like '%certutil%';
  team: ""
---
apiVersion: v1
kind: query
spec:
  automations_enabled: false
  description: POWERSHELL Execute, is a powerful interactive command-line interface and scripting environment included in the Windows operating system - ATT&CK T1218.011
  discard_data: false
  interval: 600
  logging: ""
  min_osquery_version: ""
  name: MITRE - DLL Registration
  observer_can_run: false
  platform: "windows"
  query: select * from file WHERE directory = 'C:\Windows\Prefetch\' and filename like '%regsvr%';
  team: ""
---
apiVersion: v1
kind: query
spec:
  automations_enabled: false
  description: Netsh Execute, Netsh.exe (also referred to as Netshell) is a command-line scripting utility used to interact with the network configuration of a system - ATT&CK T1484
  discard_data: false
  interval: 600
  logging: ""
  min_osquery_version: ""
  name: MITRE - Network Shell
  observer_can_run: false
  platform: "windows"
  query: select * from file WHERE directory = 'C:\Windows\Prefetch\' and filename like '%netsh%';
  team: ""
---
apiVersion: v1
kind: query
spec:
  automations_enabled: false
  description: 'Taskkill Execute, usaullay used to kill task '
  discard_data: false
  interval: 600
  logging: ""
  min_osquery_version: ""
  name: MITRE - Process Termination
  observer_can_run: false
  platform: "windows"
  query: select * from file WHERE directory = 'C:\Windows\Prefetch\' and filename like '%taskkill%';
  team: ""
---
apiVersion: v1
kind: query
spec:
  automations_enabled: false
  description: Returns the content of the key HKLM_SYSTEM_CurrentControlSet_Control_Lsa - ATT&CK T1505,S0108
  discard_data: false
  interval: 3600
  logging: ""
  min_osquery_version: ""
  name: MITRE - Registry Netsh Helper
  observer_can_run: false
  platform: "windows"
  query: select name,type,data from registry where key='HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Netsh';
  team: ""
---
apiVersion: v1
kind: query
spec:
  automations_enabled: false
  description: Lists all installed services configured to start automatically at boot - ATT&CK T1543.003
  discard_data: false
  interval: 3600
  logging: ""
  min_osquery_version: ""
  name: MITRE - Services
  observer_can_run: false
  platform: "windows"
  query: SELECT * FROM services WHERE start_type='DEMAND_START' OR start_type='AUTO_START';
  team: ""
---
apiVersion: v1
kind: query
spec:
  automations_enabled: false
  description: Returns the content of the key HKLM_SYSTEM_CurrentControlSet_Service - ATT&CK T1543.003
  discard_data: false
  interval: 3600
  logging: ""
  min_osquery_version: ""
  name: MITRE - Registry Services
  observer_can_run: false
  platform: "windows"
  query: select name, type from registry where key='HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Services';
  team: ""
---
apiVersion: v1
kind: query
spec:
  automations_enabled: false
  description: Snapshot Services query
  discard_data: false
  interval: 28800
  logging: ""
  min_osquery_version: ""
  name: MITRE - Services Snapshot
  observer_can_run: false
  platform: "windows"
  query: SELECT * FROM services;
  team: ""
---
apiVersion: v1
kind: query
spec:
  automations_enabled: false
  description: Snapshot Returns the content of the key HKLM_SYSTEM_CurrentControlSet_Service - ATT&CK T1543.003
  discard_data: false
  interval: 28800
  logging: ""
  min_osquery_version: ""
  name: MITRE - Registry Snapshot HKLM Services
  observer_can_run: false
  platform: "windows"
  query: select name, type from registry where key='HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Services';
  team: ""
---
apiVersion: v1
kind: query
spec:
  automations_enabled: false
  description: **Application Shimming** Returns the content of the key HKLM_Software_Microsoft_WindowsNT_CurrentVersion_appcompatflags_custom - ATT&CK T1546.011
  discard_data: false
  interval: 3600
  logging: ""
  min_osquery_version: ""
  name: MITRE - Registry Application Shimming Custom
  observer_can_run: false
  platform: "windows"
  query: select name,type,data from registry where key='HKEY_LOCAL_MACHINE\software\microsoft\windows nt\currentversion\appcompatflags\custom';
  team: ""
---
apiVersion: v1
kind: query
spec:
  automations_enabled: false
  description: **Application Shimming** Returns the content of the key HKLM_Software_Microsoft_WindowsNT_CurrentVersion_appcompatflags_installedsdb - ATT&CK T1546.011
  discard_data: false
  interval: 3600
  logging: ""
  min_osquery_version: ""
  name: MITRE - Registry Application Shimming Installed SDB
  observer_can_run: false
  platform: "windows"
  query: select name,type,data from registry where key='HKEY_LOCAL_MACHINE\software\microsoft\windows nt\currentversion\appcompatflags\installedsdb';
  team: ""
---
apiVersion: v1
kind: query
spec:
  automations_enabled: false
  description: Returns the content of the key HKLM_Image_File_Execution_Options - ATT&CK T1546.012
  discard_data: false
  interval: 3600
  logging: ""
  min_osquery_version: ""
  name: MITRE - Registry Image File Execution Options
  observer_can_run: false
  platform: "windows"
  query: select name,type,data from registry where key='HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Image File Execution Options';
  team: ""
---
apiVersion: v1
kind: query
spec:
  automations_enabled: false
  description: **Application Shimming** Snapshot Returns the content of the key HKLM_Software_Microsoft_WindowsNT_CurrentVersion_appcompatflags_custom - ATT&CK T1546.011
  discard_data: false
  interval: 28800
  logging: ""
  min_osquery_version: ""
  name: MITRE - Registry Snapshot HKLM Application Shimming Custom
  observer_can_run: false
  platform: "windows"
  query: select name,type,data from registry where key='HKEY_LOCAL_MACHINE\software\microsoft\windows nt\currentversion\appcompatflags\custom';
  team: ""
---
apiVersion: v1
kind: query
spec:
  automations_enabled: false
  description: **Application Shimming** Snapshot Returns the content of the key HKLM_Software_Microsoft_WindowsNT_CurrentVersion_appcompatflags_installedsdb - ATT&CK T1546.011
  discard_data: false
  interval: 28800
  logging: ""
  min_osquery_version: ""
  name: MITRE - Registry Snapshot HKLM Application Shimming Installed SDB
  observer_can_run: false
  platform: "windows"
  query: select name,type,data from registry where key='HKEY_LOCAL_MACHINE\software\microsoft\windows nt\currentversion\appcompatflags\installedsdb';
  team: ""
---
apiVersion: v1
kind: query
spec:
  automations_enabled: false
  description: Returns the content of the key HKCU_Software_Microsoft_Windows_CurrentVersion_Run - ATT&CK T1547.001
  discard_data: false
  interval: 3600
  logging: ""
  min_osquery_version: ""
  name: MITRE - Registry Current User Run
  observer_can_run: false
  platform: "windows"
  query: select name,type,data from registry where key='HKEY_CURRENT_USER\Software\Microsoft\Windows\CurrentVersion\Run';
  team: ""
---
apiVersion: v1
kind: query
spec:
  automations_enabled: false
  description: Returns the content of the key HKCU_Software_Microsoft_Windows_CurrentVersion_Policies_Explorer_Run - ATT&CK T1547.001
  discard_data: false
  interval: 3600
  logging: ""
  min_osquery_version: ""
  name: MITRE - Registry Explorer Run
  observer_can_run: false
  platform: "windows"
  query: select name,type,data from registry where key='HKEY_CURRENT_USER\Software\Microsoft\Windows\CurrentVersion\Policies\Explorer\Run';
  team: ""
---
apiVersion: v1
kind: query
spec:
  automations_enabled: false
  description: Returns the content of the key HKLM_Software_Microsoft_Windows_CurrentVersion_Policies_Explorer_Run - ATT&CK T1547.001
  discard_data: false
  interval: 3600
  logging: ""
  min_osquery_version: ""
  name: MITRE - Registry Local Machine Explorer Run
  observer_can_run: false
  platform: "windows"
  query: select name,type,data from registry where key='HKEY_LOCAL_MACHINE\Software\Microsoft\Windows\CurrentVersion\Policies\Explorer\Run';
  team: ""
---
apiVersion: v1
kind: query
spec:
  automations_enabled: false
  description: Returns the content of the key HKU_Software_Microsoft_Windows_CurrentVersion_Run
  discard_data: false
  interval: 3600
  logging: ""
  min_osquery_version: ""
  name: MITRE - Registry Users Run
  observer_can_run: false
  platform: "windows"
  query: select name,type,data from registry where key='HKEY_USERS\Software\Microsoft\Windows\CurrentVersion\Run';
  team: ""
---
apiVersion: v1
kind: query
spec:
  automations_enabled: false
  description: Windows Startup Items Osquery predefined query - ATT&CK T1547.001
  discard_data: false
  interval: 3600
  logging: ""
  min_osquery_version: ""
  name: MITRE - Startup Items
  observer_can_run: false
  platform: "windows"
  query: select * from startup_items;
  team: ""
---
apiVersion: v1
kind: query
spec:
  automations_enabled: false
  description: Returns the content of the key HKCU_Software_Microsoft_Windows_CurrentVersion_Policies_Explorer_Run - ATT&CK T1547.001
  discard_data: false
  interval: 28800
  logging: ""
  min_osquery_version: ""
  name: MITRE - Registry Snapshot HKCU Explorer Run
  observer_can_run: false
  platform: "windows"
  query: select name,type,data from registry where key='HKEY_CURRENT_USER\Software\Microsoft\Windows\CurrentVersion\Policies\Explorer\Run';
  team: ""
---
apiVersion: v1
kind: query
spec:
  automations_enabled: false
  description: Returns the content of the key HKCU_Software_Microsoft_Windows_CurrentVersion_Run - ATT&CK T1547.001
  discard_data: false
  interval: 28800
  logging: ""
  min_osquery_version: ""
  name: MITRE - Registry Snapshot HKCU Run
  observer_can_run: false
  platform: "windows"
  query: select name,type,data from registry where key='HKEY_CURRENT_USER\Software\Microsoft\Windows\CurrentVersion\Run';
  team: ""
---
apiVersion: v1
kind: query
spec:
  automations_enabled: false
  description: Returns the content of the key HKLMU_Software_Microsoft_Windows_CurrentVersion_Policies_Explorer_Run - ATT&CK T1547.001
  discard_data: false
  interval: 28800
  logging: ""
  min_osquery_version: ""
  name: MITRE - Registry Snapshot HKLM Explorer Run
  observer_can_run: false
  platform: "windows"
  query: select name,type,data from registry where key='HKEY_LOCAL_MACHINE\Software\Microsoft\Windows\CurrentVersion\Policies\Explorer\Run';
  team: ""
---
apiVersion: v1
kind: query
spec:
  automations_enabled: false
  description: Returns the content of the key HKU_Software_Microsoft_Windows_CurrentVersion_Run
  discard_data: false
  interval: 28800
  logging: ""
  min_osquery_version: ""
  name: MITRE - Registry Snapshot HKU Run
  observer_can_run: false
  platform: "windows"
  query: select name,type,data from registry where key='HKEY_USERS\Software\Microsoft\Windows\CurrentVersion\Run';
  team: ""
---
apiVersion: v1
kind: query
spec:
  automations_enabled: false
  description: Snapshot Windows Startup Items Osquery predefined query - ATT&CK T1547.001
  discard_data: false
  interval: 28800
  logging: ""
  min_osquery_version: ""
  name: MITRE - Startup Items Snapshot
  observer_can_run: false
  platform: "windows"
  query: select * from startup_items;
  team: ""
---
apiVersion: v1
kind: query
spec:
  automations_enabled: false
  description: Runas Execute, Allows a user to run specific tools and programs with different permissions than the user's current logon provides. - ATT&CK T1548.002
  discard_data: false
  interval: 600
  logging: ""
  min_osquery_version: ""
  name: MITRE - Privilege Escalation
  observer_can_run: false
  platform: "windows"
  query: select * from file WHERE directory = 'C:\Windows\Prefetch\' and filename like '%runas%';
  team: ""
---
apiVersion: v1
kind: query
spec:
  automations_enabled: false
  description: Returns the content of the key HKCU_Software_Microsoft_WindowsNT_CurrentVersion_winlogon - ATT&CK T1556
  discard_data: false
  interval: 3600
  logging: ""
  min_osquery_version: ""
  name: MITRE - Registry Current Version Winlogon
  observer_can_run: false
  platform: "windows"
  query: select name,type,data from registry where key='HKEY_CURRENT_USER\Software\Microsoft\Windows NT\CurrentVersion\Winlogon';
  team: ""
---
apiVersion: v1
kind: query
spec:
  automations_enabled: false
  description: Returns the content of the key HKLM_Software_Microsoft_WindowsNT_CurrentVersion_winlogon - ATT&CK T1556
  discard_data: false
  interval: 3600
  logging: ""
  min_osquery_version: ""
  name: MITRE - Registry Local Machine Winlogon
  observer_can_run: false
  platform: "windows"
  query: select name,type,data from registry where key='HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Winlogon';
  team: ""
---
apiVersion: v1
kind: query
spec:
  automations_enabled: false
  description: Returns the content of the key HKLM_Software_Wow6432Node_Microsoft_WindowsNT_CurrentVersion_winlogon - ATT&CK T1556
  discard_data: false
  interval: 3600
  logging: ""
  min_osquery_version: ""
  name: MITRE - Registry Wow6432Node Winlogon
  observer_can_run: false
  platform: "windows"
  query: select name,type,data from registry where key='HKEY_LOCAL_MACHINE\SOFTWARE\Wow6432Node\Microsoft\Windows NT\CurrentVersion\Winlogon';
  team: ""
---
apiVersion: v1
kind: query
spec:
  automations_enabled: false
  description: Returns the content of the key HKLM_SYSTEM_CurrentControlSet_Control_Lsa - ATT&CK T1556
  discard_data: false
  interval: 3600
  logging: ""
  min_osquery_version: ""
  name: MITRE - Registry LSA Authentication
  observer_can_run: false
  platform: "windows"
  query: select name,type,data from registry where key='HKEY_LOCAL_MACHINE\system\CurrentControlSet\Control\Lsa';
  team: ""
---
apiVersion: v1
kind: query
spec:
  automations_enabled: false
  description: Symantec Endpoint Protection service Status change - ATT&CK T1562.001
  discard_data: false
  interval: 3600
  logging: ""
  min_osquery_version: ""
  name: MITRE - Sophos Anti-Virus Services 1
  observer_can_run: false
  platform: "windows"
  query: SELECT * FROM services WHERE name = 'SAVAdminService' AND status != 'RUNNING';
  team: ""
---
apiVersion: v1
kind: query
spec:
  automations_enabled: false
  description: Symantec Endpoint Protection service Status change - ATT&CK T1562.001
  discard_data: false
  interval: 3600
  logging: ""
  min_osquery_version: ""
  name: MITRE - Sophos Anti-Virus Services 2
  observer_can_run: false
  platform: "windows"
  query: SELECT * FROM services WHERE name = 'SavService' AND status != 'RUNNING';
  team: ""
---
apiVersion: v1
kind: query
spec:
  automations_enabled: false
  description: Symantec Endpoint Protection service Status change - ATT&CK T1562.001
  discard_data: false
  interval: 3600
  logging: ""
  min_osquery_version: ""
  name: MITRE - Symantec Endpoint Protection Services
  observer_can_run: false
  platform: "windows"
  query: SELECT * FROM services WHERE name = 'SepMasterService' AND status != 'RUNNING';
  team: ""
---
apiVersion: v1
kind: query
spec:
  automations_enabled: false
  description: Windows Defender service Status change - ATT&CK T1562.001
  discard_data: false
  interval: 3600
  logging: ""
  min_osquery_version: ""
  name: MITRE - Windows Defender Services
  observer_can_run: false
  platform: "windows"
  query: SELECT * FROM services WHERE name = 'WinDefend' AND status != 'RUNNING';
  team: ""
---
apiVersion: v1
kind: query
spec:
  automations_enabled: false
  description: Windows Firewall service Status change - ATT&CK T1562.004
  discard_data: false
  interval: 3600
  logging: ""
  min_osquery_version: ""
  name: MITRE - Windows Firewall Services
  observer_can_run: false
  platform: "windows"
  query: SELECT * FROM services WHERE name = 'MpsSvc' AND status != 'RUNNING';
  team: ""
---
apiVersion: v1
kind: query
spec:
  automations_enabled: false
  description: Windows Security Service Status change - ATT&CK T1562.001
  discard_data: false
  interval: 3600
  logging: ""
  min_osquery_version: ""
  name: MITRE - Windows Security Service
  observer_can_run: false
  platform: "windows"
  query: SELECT * FROM services WHERE name = 'wscsvc' AND status != 'RUNNING';
  team: ""
---
apiVersion: v1
kind: query
spec:
  automations_enabled: false
  description: Windows Update Service Status change - ATT&CK T1562.001
  discard_data: false
  interval: 3600
  logging: ""
  min_osquery_version: ""
  name: MITRE - Windows Update Service
  observer_can_run: false
  platform: "windows"
  query: SELECT * FROM services WHERE name = 'wuauserv' AND status != 'RUNNING';
  team: ""
---
apiVersion: v1
kind: query
spec:
  automations_enabled: false
  description: Returns the content of the key HKCU_Control Panel_Desktop - ATT&CK T1562
  discard_data: false
  interval: 3600
  logging: ""
  min_osquery_version: ""
  name: MITRE - Registry Control Panel Desktop
  observer_can_run: false
  platform: "windows"
  query: select name,type,data from registry where key='HKEY_CURRENT_USER\Control Panel\Desktop';
  team: ""
